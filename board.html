
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Departures & Arrivals</title>
<style>
  body {
    background-color: #00FF00; /* Chroma key green */
    margin: 0;
    padding: 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 0 auto;
    background-color: #1e2a38;
    color: white;
    font-family: Arial, sans-serif;
    font-size: 18px;
  }

  th, td {
    border: 1px solid #30445a; /* lighter blue-gray border */
    padding: 6px 10px;
    text-align: left;
  }

  th {
    background-color: #1e2a38;
    color: white;
  }

  tr:nth-child(even) {
    background-color: #2b3b4f; /* medium blue shade */
  }

  tr:nth-child(odd) {
    background-color: #223344; /* darker blue shade */
  }

  .title-row th {
    text-align: center;
    font-size: 24px;
    padding: 12px;
    background-color: #1e2a38; /* replacing black */
    border: none;
    color: #ffff00;
  }

  .dir-dep td:first-child {
    color: #00cc66;
  }

  .dir-arr td:first-child {
    color: #ffcc00;
  }
</style>


</head>
<body>
  <table>
    <thead>
      <tr class="title-row">
        <th colspan="5">Departures & Arrivals</th>
      </tr>
      <tr>
        <th></th> <!-- Departure / Arrival label -->
        <th>Time</th>
        <th>Callsign</th>
        <th>Aircraft</th>
        <th>To/From</th> <!-- renamed -->
      </tr>
    </thead>
    <tbody id="flight-table">
      <tr><td colspan="5">Loading...</td></tr>
    </tbody>
  </table>

  <script>
    async function fetchFlights() {
      const res = await fetch("https://data.vatsim.net/v3/vatsim-data.json");
      const data = await res.json();
      const tableBody = document.getElementById("flight-table");
      const now = new Date();
      const minTime = new Date(now.getTime() - 10 * 60 * 1000); // 10 min ago

      const flights = [];

      for (const pilot of data.pilots) {
        const fp = pilot.flight_plan;
        if (!fp) continue;
        const { departure: dep, arrival: arr, aircraft_short: acft, deptime } = fp;
        if (dep !== "EGKK" && arr !== "EGKK") continue;

        const callsign = pilot.callsign;
        const isDeparture = dep === "EGKK";
        const direction = isDeparture ? "Departure" : "Arrival";
        const otherAirport = isDeparture ? arr : dep; // Only show the other code

        // Estimate time
        let flightTime = new Date(pilot.logon_time + "Z");
        if (deptime && /^\d{4}$/.test(deptime)) {
          const hours = parseInt(deptime.substring(0, 2), 10);
          const minutes = parseInt(deptime.substring(2, 4), 10);
          const utc = new Date();
          utc.setUTCHours(hours, minutes, 0, 0);
          flightTime = utc;
        }

        if (flightTime < minTime) continue;

        const localTime = flightTime.toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit"
        });

        flights.push({
          time: flightTime,
          html: `<tr class="${isDeparture ? 'dir-dep' : 'dir-arr'}">
            <td>${direction}</td>
            <td>${localTime}</td>
            <td>${callsign}</td>
            <td>${acft}</td>
            <td>${otherAirport}</td>
          </tr>`
        });
      }

      flights.sort((a, b) => a.time - b.time);
      const limited = flights.slice(0, 5);
      tableBody.innerHTML = limited.length
        ? limited.map(f => f.html).join("")
        : `<tr><td colspan="5">No upcoming flights</td></tr>`;
    }

    fetchFlights();
    setInterval(fetchFlights, 60000);
  </script>
</body>
</html>

